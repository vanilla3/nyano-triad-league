# Nyano Triad League — 自律型コミュニティ運営ロードマップ（v1）

> 目的：運営が不在でも「遊べる・回る・盛り上がる」状態を、設計の段階から仕込む  
> 前提：Ethereum専用 / Nyano Peace NFT を読み取り専用で参照（改変しない）

---

## 0. 結論（設計思想）

**“ゲーム = アプリ”ではなく、“ゲーム = プロトコル”**として設計します。

- **プロトコル層（不変）**：対戦トランスクリプト仕様、検証可能な公式戦決済、イベントログ  
- **コミュニティ層（可変）**：ルールセット（シーズン）、リーグ、トーナメント、メタの語り  
- **UI層（交換可能）**：公式UIが落ちても、誰でも別UIを作れる（公開仕様＋イベントログ）

---

## 1. 「運営がいなくても成立する」ための要件

### 1.1 単一障害点を消す
- **必須機能はすべてオンチェーンで完結**
  - 公式戦の結果確定（勝敗計算・ポイント更新）
  - 参加資格・所有権検証（ownerOf）
- バックエンドは **便利機能** に退避（マッチング、リプレイ配信、一覧高速化など）

### 1.2 データは開放する
- 対戦結果は **イベント（Events）** を中心に公開
- 公式戦の入力（トランスクリプト）と結果の再現ができる

### 1.3 “遊び場を作る権利”を開放する
- だれでも **リーグ / トーナメント** を立ち上げられる
- だれでも **ルールセット** を登録（提案）できる
- “公式っぽさ”は **コミュニティの合意（投票）** で決まる

---

## 2. 自律化の中核機能（Endgame）

### 2.1 Ruleset Registry（ルールセット登録）
**狙い**：シーズンルールを、運営ではなくコミュニティが回す。

- `rulesetId = keccak256(configBytes)` で一意化
- コンフィグは
  - オンチェーンに格納（サイズ節約が必要ならIPFS CID＋hash）
  - もしくは「オンチェーンはhash、実体はIPFS」（ただしUIは複数ソースを許容）
- spam対策：登録に少額デポジット（返還条件：一定の投票数、一定の利用数など）

### 2.2 League / Tournament Factory（遊び場の生成）
**狙い**：コミュニティが“自分たちの大会”を作れる。

- `createLeague(rulesetId, params)` でリーグ作成（permissionless）
- 参加登録 → 対戦 → 決済 → 自動集計（ポイント / バッジ）
- 賞品は「ETH賞金」に寄せると法務/UXが難化するため、まずは
  - バッジ（ERC-1155のコスメ）
  - 称号（SBT/1155）
  - スポンサーが提供する外部報酬（任意）
  を中心にする

### 2.3 “公式シーズン”は投票で選ぶ（Token不要）
**狙い**：運営者不在でも「今月の公式環境」が決まる。

- 投票権：Nyano Peace の保有者（NFTベース）
- ガス節約：**署名投票（EIP-712）** → だれでも集計トランザクションを投げられる
- 投票対象：`rulesetId`（複数候補）＋ season期間  
- 結果：勝った `rulesetId` が “Featured Season” になる（UIがデフォルト表示）

### 2.4 “公式戦”決済は誰でも実行できる
- プレイヤー2名の署名が揃っていれば、**第三者がsubmitしてもOK**
- ガス代は提出者が払うが、後で小さく補填する仕組みも検討可（ただし複雑化に注意）

---

## 3. 段階的ロードマップ（現実的な導入順）

### Phase A（MVP前半）：プロトコルを固める
- 対戦トランスクリプト仕様（versioning含む）
- 決定論ルールの参照実装（TS）＋テストベクタ
- Solidityでの決済コントラクト（まずはCoreルールだけでも良い）

### Phase B（MVP後半）：コミュニティが再利用できる形にする
- Events を設計（indexerが拾いやすい）
- サンプルindexer / subgraph の雛形を公開
- リプレイ保存は任意（IPFS推奨、hashはイベントに）

### Phase C（v1）：Ruleset Registry + Featured Season投票
- ルールセット登録（permissionless）
- 署名投票でFeatured Seasonを決める
- UIは「公式」以外のコミュニティリーグも閲覧可能にする

### Phase D（v2）：リーグ / トーナメントが勝手に増殖する世界
- LeagueFactory / TournamentFactory
- 賞品はコスメ中心（ガス/法務/荒れ対策）
- コミュニティ主導の“定例大会”が自然発生する状態を目指す

---

## 4. 設計上の注意（盛り上がるほど大事）

- **荒れ対策**：spam ruleset / 悪質大会  
  → デポジット・レピュテーション・Featured選定を分離（“存在できる”が“公式になれない”）
- **ゲームの可読性**：ルールが複雑化するとカジュアル離脱  
  → Layer 1は固定、上位レイヤーはUIで視覚説明を必須にする
- **不変と可変の線引き**：アップグレードは“最後の手段”  
  → 可能なら data-driven ruleset を採用して契約更新頻度を下げる

---

## 5. 次に作るべきドキュメント（実装に直結）
- `TRANSCRIPT_SPEC.md`（厳密な形式、署名対象、互換性）
- `RULESET_CONFIG.md`（data-drivenの構造、許容範囲、デフォルト）
- `EVENTS.md`（indexer/analyticsが参照するログ仕様）
